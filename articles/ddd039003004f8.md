---
title: "NextJS(AppRouter)ã§å©ãNotion Api"
emoji: "ğŸ˜"
type: "tech"
topics:
  - "nextjs"
  - "typescript"
  - "notion"
  - "notionapi"
  - "approuter"
published: true
published_at: "2024-02-29 23:17"
---

## ç›®çš„

ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹éš›ã«ã€ãƒšãƒ¼ã‚¸ã®æ›´æ–°ã‚’ã—ã¦ã„ãã®ã¯é–‹ç™ºè€…ã ã‘ã§ãªãã€ä¸€èˆ¬ã®äººï¼ˆã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ãªã„äººï¼‰ã‚‚æ›´æ–°ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Œã°ã€é–‹ç™ºå´ã®è² æ‹…è»½æ¸›ã€ãƒšãƒ¼ã‚¸ã®å³æ™‚æ›´æ–°ã«ã¤ãªãŒã‚‹ã€‚ã€‚ãã®ãŸã‚èª°ã§ã‚‚ç·¨é›†ãŒå¯èƒ½ã§ã‚ã‚‹ notion ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚

## å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰

https://github.com/nagisa599/notion-api-study

## ä½¿ç”¨æŠ€è¡“

- notionhq/client(2.2.14)
- next(14.0.4)
- react(18),
- notion-to-md (3.1.1),
- react-markdown (9.0.1)
- remark-gfm(4.0.0)

## äº‹å‰æº–å‚™

### notion ã®äº‹å‰æº–å‚™

#### integrations ã®è¨­å®š

https://www.notion.so/my-integrations ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã—ã€ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆã‚’è¡Œã†
ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆã‚’è¡Œã†ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ãŒå¾—ã‚‰ã‚Œã‚‹ã€‚ã¾ãŸã“ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã¯ api ã‚’å©ãéš›ã«å¿…è¦ãªãŸã‚ãƒ¡ãƒ¢ã‚’ã—ã¨ãã“ã¨ã€‚
![](https://storage.googleapis.com/zenn-user-upload/0f951ad81b7d-20240229.png)

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆã¨è¨­å®š

1. notion ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ
2. å³ä¸Šã® 3 ç‚¹ãƒªãƒ¼ãƒ€ã‚’é¸æŠ
3. æ¥ç¶šå…ˆã‚’é¸æŠ
4. intergations ã§è¨­å®šã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’é¸æŠ
   ![](https://storage.googleapis.com/zenn-user-upload/961ccde03280-20240229.png)

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆã¨è¨­å®š

ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® url(xxx ã®éƒ¨åˆ†ï¼‰ã‚’ãƒ¡ãƒ¢ã‚’ã™ã‚‹ã€‚

```
https://www.notion.so/xxxxx?v=yyyyy
```

### NextJs ã®äº‹å‰æº–å‚™

#### NextJs ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
npx create-next-app@latest --typescrip
```

#### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

@notionhq/clint ã¯ã€Notion ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã‚ã‚‹ã€‚
notion-to-md ã¯,Notion ã®æœ¬æ–‡ã‚’å–å¾—ã—ã€MarkDown æ›¸å¼ã§ç”Ÿæˆã—ã¦ãã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã‚ã‚‹ã€‚
ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ã¯ã€Notion ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ãŸã‘ã‚Œã°ã€@notionhq/clint ã‚’åˆ©ç”¨ã—ã€æœ¬æ–‡ã‚’å–å¾—ã—ãŸã‘ã‚Œã°ã€notion-to-md ã‚’åˆ©ç”¨ã™ã‚‹æ„Ÿã˜ã§ã‚ã‚‹ã€‚

```
npm i @notionhq/client notion-to-md
```

#### .env ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°

.env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã«è¨˜è¿°ã€‚notion ã§å–å¾—ã—ãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆããƒ¼ã¨ url(xxxx ã®éƒ¨åˆ†ï¼‰ã‚’ãã‚Œãã‚Œ env ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¼‰ã™ã‚‹ã€‚

```
NEXT_PUBLIC_NOTION_API_KEY = "secret_aaaaaaa"
NEXT_PUBLIC_DB_URL = "xxxx"
```

#### NotionClient ã‚’ä½œæˆ

```ts
import { Client } from "@notionhq/client";

// Notion APIã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ
export const notion = new Client({
  auth: process.env.NEXT_PUBLIC_NOTION_API_KEY,
});
```

#### ãƒ•ãƒ­ãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã®ä½œæˆ

```ts
import React from "react";
import { headers } from "next/headers";
const page = async () => {
  const host = headers().get("host");
  // ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
  const responseTableData = await fetch(`http://${host}/api/notion`);
  const tableData = await responseTableData.json();

  // ãƒšãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
  const detailId = "aifhaifhaie;hfaiehfae;hfae"; //ãƒšãƒ¼ã‚¸ID(ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å–å¾—ã™ã‚‹éš›ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦idãŒå¾—ã‚‰ã‚Œã‚‹
  const responsePageData = await fetch(`http://${host}/api/notion/${detailId}`);
  const Data = await responsePageData.json();

  return <div></div>;
};

export default page;
```

## å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰

### ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã€ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã®å–å¾—

```ts
import { notion } from "@/utils/notionClient";
import { NextResponse } from "next/server";
const corsHeaders = {
  "Access-Control-Allow-Origin": "*", // ã™ã¹ã¦ã®ã‚ªãƒªã‚¸ãƒ³ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯
  "Access-Control-Allow-Methods": "GET", // è¨±å¯ã•ã‚Œã‚‹HTTPãƒ¡ã‚½ãƒƒãƒ‰
  "Access-Control-Allow-Headers": "Content-Type", // è¨±å¯ã•ã‚Œã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼
  "Content-Type": "application/json",
};

export async function GET() {
  try {
    const databaseId = process.env.NEXT_PUBLIC_DB_URL || "DEFAULT_DATABASE_ID";
    const notionResponse = await notion.databases.query({
      database_id: databaseId,
    });
    //å®Ÿéš›ã«ãƒ•ãƒ­ãƒ³ãƒˆã«è¿”ã™ãƒ‡ãƒ¼ã‚¿ã‚’æ±ºã‚ã‚‹ã€‚
    const Response = await Promise.all(
      notionResponse.results.map(async (result: any) => {
        const id = result.id; // eslint-disable-line
        const title = result.properties.name.title[0].plain_text; // eslint-disable-line
        return { id, title };
      })
    );
    return new NextResponse(JSON.stringify(Response), {
      headers: corsHeaders,
      status: 200,
    });
  } catch (error) {
    console.error(error); // ã‚¨ãƒ©ãƒ¼ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
    return new NextResponse(
      JSON.stringify({ error: "Internal Server Error" }),
      {
        headers: corsHeaders,
        status: 500,
      }
    );
  }
}
```

notionResponse ã®ä¸­èº«ã¨ã—ã¦ã¯ã€ä»¥ä¸‹ã®å†™çœŸã®é€šã‚Šã¨ãªã‚‹ã€‚ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸­èº«ã ã‘ã§ãªãã€ãã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆæ—¥ã€æ›´æ–°æ—¥ã€æ›´æ–°è€…ãªã©ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚‚å–å¾—ãŒã§ãã‚‹ã€‚å®Ÿéš›ã«ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ã¯ã€properties ã«å…¥ã£ã¦ã„ã‚‹ã€‚

```
{
  object: 'list',
  results: [
    {
      object: 'page',
      id: 'xxxxxx',
      created_time: '2024-02-25T01:24:00.000Z',
      last_edited_time: '2024-02-25T14:52:00.000Z',
      created_by: [Object],
      last_edited_by: [Object],
      cover: null,
      icon: null,
      parent: [Object],
      archived: false,
      properties: [Object],
      url: 'https://www.notion.so/yyyyy',
      public_url: null
    },
    {
      object: 'page',
      id: 'xxxx',
      created_time: '2024-02-25T01:24:00.000Z',
      last_edited_time: '2024-02-29T06:38:00.000Z',
      created_by: [Object],
      last_edited_by: [Object],
      cover: [Object],
      icon: [Object],
      parent: [Object],
      archived: false,
      properties: [Object],
      url: 'https://www.notion.so/yyyy',
      public_url: null
    }
  ],
  next_cursor: null,
  has_more: false,
  type: 'page_or_database',
  page_or_database: {},
  request_id: 'zzzzzzzzz'
}
```

# ãƒšãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ã®å–å¾—

```ts
import { NotionToMarkdown } from "notion-to-md";
import { NextResponse } from "next/server";
import { notion } from "@/utils/notionClient";
const corsHeaders = {
  "Access-Control-Allow-Origin": "*", // ã™ã¹ã¦ã®ã‚ªãƒªã‚¸ãƒ³ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯
  "Access-Control-Allow-Methods": "POST, GET, OPTIONS, DELETE, PUT", // è¨±å¯ã•ã‚Œã‚‹HTTPãƒ¡ã‚½ãƒƒãƒ‰
  "Access-Control-Allow-Headers": "Content-Type", // è¨±å¯ã•ã‚Œã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼
  "Content-Type": "application/json",
};
export async function GET(
  request: Request,
  { params }: { params: { id: string } }
) {
  try {
    const { id } = params;
    const n2m = new NotionToMarkdown({ notionClient: notion });
    const mdblocks = await n2m.pageToMarkdown(id);
    const mdString = n2m.toMarkdownString(mdblocks);
    const response = mdString.parent;
    return new NextResponse(JSON.stringify(response), {
      headers: corsHeaders,
      status: 200,
    });
  } catch (error) {
    console.error(error); // ã‚¨ãƒ©ãƒ¼ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
    return new NextResponse(
      JSON.stringify({ error: "Internal Server Error" }),
      {
        headers: corsHeaders,
        status: 500,
      }
    );
  }
}
```

å®Ÿéš›ã«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«è¿”ã™éš›ã¯ã€Markdown å½¢å¼ã§è¿”ã—ã¦ã„ã‚‹ã€‚

## è£œè¶³ã€€

- é–¢é€£ã‚µãƒ¼ãƒ“ã‚¹ã®ç´¹ä»‹
  - react-markdown (9.0.1)ã€€ï¼ˆMarkdown ã‚’ HTML ã«å¤‰æ›ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰
  - remark-gfm(4.0.0)ã€€ï¼ˆMarkdwon ã« css ã‚’é©å¿œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰
- å‚è€ƒæ–‡çŒ®ã‚„ã€å…¬å¼ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ãªã©
  https://github.com/nagisa599/notion-api-study

## ãŠã‚ã‚Šã«

notion ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ„å¤–ã¨ä½•ã§ã‚‚ã§ãã‚‹~ ä¾¿åˆ©~
