---
title: "Device Preview for Flutterã€githubaction,firebasehostringã‚’ä½¿ã£ã¦çˆ†é€Ÿãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç›®æŒ‡ã™"
emoji: "ğŸš€"
type: "tech"
topics:
  - "flutter"
  - "githubactions"
  - "ãƒãƒ¼ãƒ é–‹ç™º"
  - "firebasehosting"
published: true
published_at: "2024-03-16 14:19"
---

# ç›®çš„
è¤‡æ•°ã«flutterã‚’é–‹ç™ºã™ã‚‹éš›ã«ã€è‡ªåˆ†ã®ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚³ãƒ¼ãƒ‰ã‚’å…¥ã‚Œã¦ç”»é¢ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€æ‰‹é–“ã¨æ™‚é–“ãŒã‹ã‹ã£ã¦ã—ã¾ã£ã¦ã„ãŸã€‚ãã“ã§Device Preview for Flutterã‚’ä½¿ã„ã€webä¸Šã«ç”»é¢ã«å‡ºåŠ›ã‚’è¡Œã†ã“ã¨ã§ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ç¢ºèªã‚’çœãã“ã¨ã«ã—ãŸã€‚ã¾ãŸgithubactionã¨firebaseã€€hostringã‚’ä½¿ã†ã“ã¨ã§è‡ªå‹•åŒ–ã‚’è¡Œã„ã€æ™‚é–“ã®å‰Šæ¸›ã‚’è¡Œãªã£ãŸã€‚


# å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰
https://github.com/nagisa599/flutter-firebasehostging-test

# æŠ€è¡“é¸å®š
ä»Šå›ã¯ã€vercelã¨firebasehostringã©ã¡ã‚‰ã‚’åˆ©ç”¨ã™ã‚‹ã‹è¿·ã£ãŸã‚‰ãŒã€ã€€vercelã®æ–¹ã¯ã€previewã¨ã—ã¦ä½œæˆã—ãŸdeployã‚’æœŸé–“ã‚’æ±ºã‚ã¦å‹•ã‹ã™ã“ã¨ãŒã§ãã‚‹ï¼ˆåŸºæœ¬10æ—¥ï¼‰ãŸã‚ç„¡é§„ãªãƒªã‚½ãƒ¼ã‚¹ã‚’å‰²ã‹ãªã„ã§æ¸ˆã‚€ãŸã‚firebasehostringã‚’åˆ©ç”¨ã—ãŸã€‚

# ä½¿ç”¨æŠ€è¡“ 
- cupertino_icons: ^1.0.6
- device_preview: ^1.1.0

# äº‹å‰æº–å‚™
## flutterã®æ§‹ç¯‰
### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
https://pub.dev/packages/device_preview

```
flutter pub add device_preview

```



### main.dartã®å¤‰æ›´
å¤‰æ›´ç®‡æ‰€

- runAppã®ä¸­ã«devicePreviewã®è¨­å®šã‚’è¿½åŠ 
- wightã®ä¸­ã«builderã¨localeã‚’è¨­å®š
```
import 'package:flutter/material.dart';
import 'package:device_preview/device_preview.dart';

void main() {
  runApp(
    DevicePreview(
      enabled: true,
      tools: const [
        ...DevicePreview.defaultTools,
      ],
      builder: (context) => const MyApp(),
    ),
  );
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  // This widget is the root of your application.
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo4',
      theme: ThemeData(
        colorScheme: ColorScheme.fromSeed(seedColor: Colors.deepPurple),
        useMaterial3: true,
      ),
      builder: DevicePreview.appBuilder,
      locale: DevicePreview.locale(context),
      home: const MyHomePage(title: 'Flutter Demo Home Page2'),
    );
  }
}

class MyHomePage extends StatefulWidget {
  const MyHomePage({super.key, required this.title});

  final String title;

  @override
  State<MyHomePage> createState() => _MyHomePageState();
}

class _MyHomePageState extends State<MyHomePage> {
  int _counter = 0;

  void _incrementCounter() {
    setState(() {
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        backgroundColor: Theme.of(context).colorScheme.inversePrimary,
        // Here we take the value from the MyHomePage object that was created by
        // the App.build method, and use it to set our appbar title.
        title: Text(widget.title),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            const Text(
              'You have pushed the button this many times:',
            ),
            Text(
              '$_counter',
              style: Theme.of(context).textTheme.headlineMedium,
            ),
          ],
        ),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        tooltip: 'Increment',
        child: const Icon(Icons.add),
      ), // This trailing comma makes auto-formatting nicer for build methods.
    );
  }
}

```



## firebaseã€€hostingã®è¨­å®š
### firebasehostringã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã¯ã€ã“ã¡ã‚‰ã‚’å‚è€ƒã«è¡Œã„ã¾ã—ãŸã€‚
https://zenn.dev/snova301/books/6df29a230d681f/viewer/8d8b4a

## githubactionsã®è¨­å®š
### FIREBASE_TOKENã®å–å¾—
```
firebase login:ci
```

### githubã®è¨­å®š
1.ã€€settingã‚’é¸æŠ
2.ã€€Secrets and variablesã®ä¸­ã®actionã‚’é¸æŠ
3.ã€€Repository secretsã«New repositoryã€€sercretã§FIREBASE_TOKENã‚’ä½œæˆ
### githubæ¨©é™ã®å¤‰æ›´
1. settringã‚’é¸æŠ
2. Actionã®generlã‚’é¸æŠ
3. Workflow permissionsã‚’Read and write permissionsã«ãƒã‚§ãƒƒã‚¯

### ymlãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®è¨˜è¿°
- developã¸ã®pull requestãŒã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°
- developã¸ã®mergeã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°
ã“ã®ï¼’ã¤ã§å®Ÿè£…ã‚’è¡Œã„ãŸã„ã¨æ€ã„ã¾ã™ã€‚

#### developã¸ã®pull requestãŒã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ymlãƒ•ã‚¡ã‚¤ãƒ«
- ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®šã™ã‚‹ï¼ˆonã®éƒ¨åˆ†ï¼‰ã€‚
- jobã®ä¸­ã®ä»®æƒ³ãƒã‚·ãƒ³ã¯ã€ubuntuuã®æœ€æ–°ã‚’é¸æŠã€‚
- stepã®é †åºã¨ã—ã¦ã¯ã€
    - checkout(ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚³ãƒ”ãƒ¼ï¼‰
    - setup flutter (subosito/fultter-actionã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ç’°å¢ƒã‚’æ§‹ç¯‰ï¼‰
    - build web (webç‰ˆã¨ã—ã¦build)
    - Deploy to Firebase Hosting Preview Channel(firebaseã«deploy)
        - channelIdã€€liveã®æ™‚ã¯æœ¬ç•ªç’°å¢ƒï¼ˆä»Šå›ã¯ã€developã«è¨­å®šï¼‰
        - channnelIdã‚’è¨­å®šã—ãªã„å ´åˆã¯ã€é–‹ç™ºç’°å¢ƒï¼ˆpreview) ï¼ˆä»Šå›ã¯,pullrequestï¼‰ã®æ™‚


```
name: Deploy to Firebase Hosting Preview Channel

on:
  pull_request:
    branches:
      - develop

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v2

      - name: Setup Flutter
        uses: subosito/flutter-action@v1
        with:
          flutter-version: "3.x"

      - name: Build Web
        run: flutter build web

      - name: Deploy to Firebase Hosting Preview Channel
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: "${{ secrets.GITHUB_TOKEN }}"
          firebaseServiceAccount: "${{ secrets.FIREBASE_TOKEN }}"
          # channelId: live
          projectId: fir-hosting-test-e202b
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}

```


```
name: Deploy to Firebase Hosting on Merge

on:
  push:
    branches:
      - develop

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v2

      - name: Setup Flutter
        uses: subosito/flutter-action@v1
        with:
          flutter-version: "3.x"

      - name: Build Web
        run: flutter build web

      - name: Deploy to Firebase Hosting
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: "${{ secrets.GITHUB_TOKEN }}"
          firebaseServiceAccount: "${{ secrets.FIREBASE_TOKEN }}"
          channelId: live
          projectId: fir-hosting-test-e202b # ã‚ãªãŸã®Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã«ç½®ãæ›ãˆã¦ãã ã•ã„
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}

```


![](https://storage.googleapis.com/zenn-user-upload/8e476bd17ad6-20240316.png)


## è£œè¶³ãƒ»å‚è€ƒ 
https://zenn.dev/flutteruniv_dev/articles/flutter_device_preview
https://github.com/nagisa599/flutter-firebasehostging-test


## ãŠã‚ã‚Šã«,ã“ã‚Œã‹ã‚‰
é–‹ç™ºç’°å¢ƒã®CI/CDã®æ§‹ç¯‰ã¯ã€å®Œäº†ã—ãŸã®ã§æ¬¡ã¯ã€æœ¬ç•ªç’°å¢ƒ(ios,andoroid)ã¸ã®CI/CDã®éƒ¨åˆ†ã‚’ä½œæˆã—ã¦ã„ããŸã„ã€‚