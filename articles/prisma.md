---
title: "prisma migrationã‚’é€”ä¸­ã‹ã‚‰å°å…¥ã—ãŸè©±"
emoji: "ğŸ¡"
type: "tech"
topics: ["prisma", "typescript", "DB", " migration", "migration"]
published: true
---

## ç›®çš„

ä»¥å‰ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§é–‹ç™ºã‚’ã—ã¦ãŠã‚Šã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ›´æ–°ã™ã‚‹éš›ã¯ã€npx prism db push(prisma_shema ã®å‹ã‚’å¼·åˆ¶çš„ã« DB ã«åæ˜ ã•ã›ã‚‹ã“ã¨)ã‚’ã—ã¦ã„ãŸã€‚ã—ã‹ã—ã€ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€DB ã‚’ npx primsa db push ã§æ›´æ–°ã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã‚‹æã‚ŒãŒã‚ã£ãŸã€‚ãã“ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å°å…¥ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚ä»Šå›ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¨ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒã‚’åˆ†ã‘ã¦èª¬æ˜ã‚’ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚­ãƒ¼ãƒã‚„ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æ›´æ–°ã™ã‚‹ä½œæ¥­ã®ã“ã¨ã€‚ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ§‹é€ ã‚„å†…å®¹ã‚’å®‰å…¨ã«å¤‰æ›´ãƒ»ç§»è¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ãŸã¨ãˆã°ã€æ–°ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¿½åŠ ã—ãŸã‚Šã€æ—¢å­˜ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ãƒ»å‰Šé™¤ã™ã‚‹å ´åˆãªã©ãŒå«ã¾ã‚Œã¾ã™ã€‚

## migration å°å…¥ã€€(ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ)

- migraion ã®åˆæœŸè¨­å®šã‚’è¡Œã†ã€‚

```bash
# prsima migrationã®åˆæœŸè¨­å®š
npx prisma migration init
```

- ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹

```bash
.
â””â”€ prisma
   â”œâ”€â”€ migration
   |    â””â”€â”€ 202401010000_init
   |      â””â”€â”€ migration.sql
   â””â”€â”€ schema.prisma
```

## migration å°å…¥å¾Œ(ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ)

- prisma_schema ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´

- migration ã®å®Ÿè¡Œ

```bash
# migrationã®ä½œæˆ
npx prisma migrate dev --name <ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å>
```

:::message

### ãŠã™ã™ã‚å‘½åè¦å‰‡

#### migration ã®åå‰ã¯[æ“ä½œ]_[ç²’åº¦]_[ãƒ†ãƒ¼ãƒ–ãƒ«å]

- æ“ä½œã€€= add(è¿½åŠ ) delete(å‰Šé™¤) edit(ç·¨é›†)
- ç²’åº¦ = table(ãƒ†ãƒ¼ãƒ–ãƒ«) column(ã‚«ãƒ©ãƒ )
- ãƒ†ãƒ¼ãƒ–ãƒ«å
  :::

## migration å°å…¥ã€€(ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ)

- migration ã®åˆæœŸè¨­å®šã‚’ DB ã«åæ˜ 

```bash
 npx prisma db execute --file ./prisma/migrations/20240713025925_init/migration.sql
```

## migration ã€€å°å…¥å¾Œ (ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ)

- å¤‰æ›´ã—ãŸ migaration ã‚’ DB ã«åæ˜ ã—ã¦ã„ãã€‚

```bash
npx prisma migration deploy
```

## ãã®ä»–

### migration deploy ã¨ migration dev ã®é•ã„

```bash
# ------------ä¾‹----------------------
# 2024å¹´ã®1æœˆ1æ—¥ã«migrationã‚’å°å…¥
# 2024å¹´ã®1æœˆ2æ—¥ã«migrationã‚’å®Ÿè¡Œ
# 2024å¹´ã®1æœˆ3æœˆã«migartionã‚’å®Ÿè¡Œ
.
â””â”€ prisma
   â”œâ”€â”€ migration
   |    â”œâ”€â”€ 202401010000_init
   |    | â””â”€â”€ migration.sql
   |    â”œâ”€â”€ 202401020000_add_test_colum
   |    | â””â”€â”€ migration.sql
   |    â”œâ”€â”€ 202401030000_add_test2_colum
   |    ã€€â””â”€â”€ migration.sql
   â””â”€â”€ schema.prisma
```

#### migration deploy

- DB ã« migartion ã‚’åæ˜ ã—ã¦ã„ãªã„ã¨ã“ã‚ã‹ã‚‰ migration ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã€‚ä¾‹ã¨ã—ã¦ã€202401010000_init ã®ã¿ã® migration ã‚’ DB ã«åæ˜ ã•ã›ãŸçŠ¶æ…‹ã« migartion deploy ã‚’è¡Œã†ã¨ 401020000_add_test_colum ã¨ 202401030000_add_test2_colum ã® migration ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚

```bash
# å·®åˆ†ã®å¤‰æ›´
npx prisma migration deploy
```

#### migration deploy

- DB ã« migartion ã‚’æœ€åˆã‹ã‚‰å…¨ã¦ migration ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã€‚ä¾‹ã¨ã—ã¦ã€202401010000_init ã®ã¿ã® migration ã‚’ DB ã«åæ˜ ã•ã›ãŸçŠ¶æ…‹ã« migartion dev ã‚’è¡Œã†ã¨ ã¦ã€202401010000_init ã¨ 401020000_add_test_colum ã¨ 202401030000_add_test2_colum ã®å…¨ã¦ã® migration ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚

```bash
# å…¨ã¦ã® migration ã‚’å¤‰æ›´
npx prisma migration dev
```

## ã¾ã¨ã‚

migration ã‚’å°å…¥ã—ãŸãŠã‹ã’ã§ DB ã®å¤‰æ›´ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã‚‹ã“ã¨ã‚’é˜²ãã“ã¨ãŒã§ããŸã€‚

## ä»Šå¾Œ

ç¾çŠ¶ã§ã¯ã€migration ã‚’æ‰‹å‹•ã§è¡Œãªã£ã¦ã„ã‚‹ãŒã€ä»Šå¾Œã¯ã€CI/CD ã‚’å°å…¥ã—ã¦ miration ã®è‡ªå‹•åŒ–ã‚’è¡Œã£ã¦ã„ããŸã„ã€‚
